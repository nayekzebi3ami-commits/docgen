<div *ngIf="ticket" class="bg-gray-900 p-4 rounded-lg max-w-md mx-auto">
    <h2 class="text-xl font-bold mb-1 text-white">{{ ticket.title }}</h2>
    <p class="text-sm text-gray-400 mb-2">{{ ticket.desc }}</p>
    <div class="flex justify-between text-xs text-gray-400 mb-4">
        <span>Créé le : {{ ticket.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
        <span>Mis à jour : {{ ticket.updatedAt | date:'dd/MM/yyyy HH:mm' }}</span>
    </div>
    <div class="mb-2">
        <span
            [class]="'px-2 inline-flex text-xs leading-5 font-semibold rounded-full ' + getStatusColor(ticket.status)">
            {{ ticket.status }}
        </span>
    </div>

    <!-- Affichage des messages -->
    <div class="space-y-3 mb-4">
        <div *ngFor="let message of ticket.messages; trackBy: trackByMessage"
            [ngClass]="{'ml-auto text-right': isCurrentUserMessage(message), 'mr-auto text-left': isOtherUserMessage(message)}"
            class="max-w-[80%]">

            <!-- Affichage du nom de l'expéditeur -->
            <p class="text-xs font-bold text-gray-400 mb-1"
                [ngClass]="{'text-right': isCurrentUserMessage(message), 'text-left': isOtherUserMessage(message)}">
                {{ message.sender === 'admin' ? 'Admin' : 'User' }}
            </p>

            <!-- Style du message en fonction de l'expéditeur -->
            <div [ngClass]="{
                    'bg-blue-600': isCurrentUserMessage(message),
                    'bg-gray-700': isOtherUserMessage(message)
                }" class="p-2 rounded-lg text-white">
                <p class="text-sm">{{ message.message }}</p>
            </div>

            <!-- Alignement et format de la date -->
            <p class="text-xs text-gray-400 mt-1"
                [ngClass]="{'text-right': isCurrentUserMessage(message), 'text-left': isOtherUserMessage(message)}">
                {{ message.date | date:'dd/MM/yyyy HH:mm' }}
            </p>
        </div>
    </div>

    <!-- Zone de saisie du message, seulement si le ticket est ouvert -->
    <div *ngIf="ticket.status === 'open' || ticket.status == 'in_progress'" class="mt-4">
        <textarea [(ngModel)]="newMessage" class="w-full p-2 rounded bg-gray-800 text-white mb-2 text-sm"
            placeholder="Votre réponse..."></textarea>
        <button (click)="sendMessage(newMessage)"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-sm">
            Envoyer
        </button>
    </div>

    <!-- Bouton pour fermer le ticket (visible uniquement pour l'admin si le ticket est ouvert) -->
    <div *ngIf="admin && (ticket.status === 'open' || ticket.status === 'in_progress')" class="mt-4">
        <button (click)="closeTicket()"
            class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded text-sm">
            Fermer le ticket
        </button>
    </div>
</div>