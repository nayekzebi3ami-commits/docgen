<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-100 overflow-y-auto">
    <div
        class="bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-md mx-auto my-8 sm:max-h-screen max-h-[80vh] overflow-y-auto">
        <h2 class="text-2xl font-bold mb-4 text-white text-center">{{ formTitle }}</h2>

        <div class="overflow-y-auto max-h-[60vh] px-4 py-2">
            <form [formGroup]="dataForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading && !fileReady"
                class="space-y-6 bg-gray-900 p-4 rounded-lg shadow-lg">

                <ng-container *ngFor="let field of formFields">
                    <div class="flex flex-col gap-2">
                        <label [for]="field.name" class="text-sm font-medium text-gray-300">{{ field.label }}</label>
                        <ng-container [ngSwitch]="field.type">
                            <input *ngSwitchCase="'text'" [type]="field.type" [id]="field.name"
                                [formControlName]="field.name"
                                class="w-full bg-gray-700 text-white rounded-md border border-gray-600 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input *ngSwitchCase="'date'" type="date" [id]="field.name" [formControlName]="field.name"
                                class="w-full bg-gray-700 text-white rounded-md border border-gray-600 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <select *ngSwitchCase="'select'" [id]="field.name" [formControlName]="field.name"
                                class="w-full bg-gray-700 text-white rounded-md border border-gray-600 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionnez</option>
                                <option *ngFor="let option of field.options" [value]="option.value">{{ option.label }}
                                </option>
                            </select>
                            <textarea *ngSwitchCase="'textarea'" [id]="field.name" [formControlName]="field.name"
                                rows="3"
                                class="w-full bg-gray-700 text-white rounded-md border border-gray-600 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </ng-container>
                    </div>
                </ng-container>

                <div class="flex justify-end">
                    <button type="submit" [disabled]="!dataForm.valid"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300"
                        [ngClass]="{'opacity-50 cursor-not-allowed': !dataForm.valid}">
                        Valider
                    </button>
                </div>
            </form>
        </div>

        <div *ngIf="isLoading" class="text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"></div>
            <p class="mt-2 text-white">Génération du document en cours...</p>
        </div>

        <div *ngIf="fileReady" class="text-center py-8">
            <p class="mb-4 text-white">Votre document est prêt !</p>
            <button (click)="downloadFile()" [disabled]="documentDownloaded"
                class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300"
                [ngClass]="{'opacity-50 cursor-not-allowed': documentDownloaded}">
                {{ documentDownloaded ? 'Document téléchargé' : 'Télécharger le fichier' }}
            </button>
        </div>

        <div *ngIf="documentUrl !== ''" class="mt-4 text-center">
            <button (click)="closeModal()"
                class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300">
                Fermer
            </button>
        </div>
    </div>
</div>